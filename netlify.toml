# Netlify configuration for NFT Marketplace Backend
[build]
  # Build command for NestJS
  command = "pnpm run build"

  # Functions directory
  functions = "netlify/functions"

  # Node.js version and environment variables

# Plugin to auto-install function dependencies
[[plugins]]
  package = "@netlify/plugin-functions-install-core"
# NOTE: Large environment variables have been moved to Netlify's Environment Variables dashboard
# to avoid the 4KB AWS Lambda limit. Please set these in your Netlify site settings:
#
# Required environment variables to set in Netlify dashboard:
# - FIREBASE_PRIVATE_KEY (the full private key)
# - DEFENDER_API_SECRET
# - PINATA_JWT (the full JWT token)
# - MORALIS_API_KEY (the full API key)
# - PRIVATE_KEY (blockchain private key)
# - ENCRYPTION_KEY (wallet encryption key)

[build.environment]
  NODE_VERSION = "18"
  # Server Configuration
  PORT = "8081"
  NODE_ENV = "production"
  FRONTEND_URL = "https://nft-market-tuna.netlify.app"

  # JWT Configuration
  JWT_SECRET = "nft2025"
  JWT_EXPIRES_IN = "7d"

  # Firebase Configuration (non-sensitive)
  FIREBASE_PROJECT_ID = "lavie-196cd"
  FIREBASE_CLIENT_EMAIL = "firebase-adminsdk-fbsvc@lavie-196cd.iam.gserviceaccount.com"
  FIREBASE_API_KEY = "AIzaSyDbyPtD6BVEbefBieILYeBjLCS35abN7aM"
  FIREBASE_AUTH_DOMAIN = "lavie-196cd.firebaseapp.com"
  FIREBASE_STORAGE_BUCKET = "lavie-196cd.firebasestorage.app"
  FIREBASE_MESSAGING_SENDER_ID = "631172388937"
  FIREBASE_APP_ID = "1:631172388937:web:3de000ee30131caeba4798"
  FIREBASE_MEASUREMENT_ID = "G-HVM047V56C"

  # OpenZeppelin Defender Configuration (non-sensitive)
  DEFENDER_API_KEY = "ArjaqtuKsioJW62cJTKE82nL5npde2sB"
  DEFENDER_RELAYER_ADDRESS = "0x2ba190287a390cfa282E4B9aE57F758F28BA96d5"
  DEFENDER_RELAYER_ID = "ffd9488c-0af9-4c0a-8d3c-29e199a1c8c9"
  DEFENDER_MINT_AUTOTASK_ID = "7d0bc3c1-7578-472e-afdf-8d03d4c6611b"
  DEFENDER_TRANSFER_AUTOTASK_ID = "e9219e0c-c338-408e-b668-06cafb64cd1c"
  DEFENDER_QUERY_AUTOTASK_ID = "118413eb-f845-40c5-83da-288b32a1862a"

  # Webhook URLs (shortened)
  DEFENDER_MINT_WEBHOOK_URL = "https://api.defender.openzeppelin.com/actions/7d0bc3c1-7578-472e-afdf-8d03d4c6611b/runs/webhook/358d6c75-54ec-49b9-bc3d-a558293d8ce0/BVjG5mR1Rx3m1X9ESGdhUp"
  DEFENDER_TRANSFER_WEBHOOK_URL = "https://api.defender.openzeppelin.com/autotasks/e9219e0c-c338-408e-b668-06cafb64cd1c/runs/webhook/EseGNoLu9dNxuZtaHVG8bu"
  DEFENDER_QUERY_WEBHOOK_URL = "https://api.defender.openzeppelin.com/autotasks/118413eb-f845-40c5-83da-288b32a1862a/runs/webhook/7U65Gq8YtAiYyV7gfNCmfw"

  # Blockchain Configuration
  NETWORK_NAME = "polygon-amoy"
  RPC_URL = "https://rpc-amoy.polygon.technology"
  CONTRACT_ADDRESS = "0x5B8c37aBdd3Dc72874d20a9403549798309599b5"
  CHAIN_ID = "80002"
  BLOCK_EXPLORER = "https://amoy.polygonscan.com/"

  # IPFS Configuration (non-sensitive)
  PINATA_API_KEY = "f95bfdf8b3f6139ef103"
  PINATA_SECRET_KEY = "57421dc41de62128b6b66696a7f53b5ccf87c6241afc95ce9da0d33914075901"
  IPFS_GATEWAY = "https://gateway.pinata.cloud/ipfs/"

  # Hardhat Configuration (non-sensitive)
  POLYGON_RPC_URL = "https://rpc-amoy.polygon.technology"
  POLYGONSCAN_API_KEY = "7BBQ9JF4T2M26QIA5M8E8HNPW58MNQISUP"

  # Webhook Configuration
  WEBHOOK_URL = "https://nft-market-api.netlify.app/api/webhook"

# API routes
[[redirects]]
  from = "/api/auth/*"
  to = "/.netlify/functions/auth"
  status = 200

[[redirects]]
  from = "/api/nft/*"
  to = "/.netlify/functions/nft"
  status = 200

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/api"
  status = 200

# CORS headers
[[headers]]
  for = "/api/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Headers = "Content-Type, Authorization"
    Access-Control-Allow-Methods = "GET, POST, PUT, DELETE, OPTIONS"
